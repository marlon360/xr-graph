<html>

<head>
  <title>VR Graph</title>
</head>

<body>
  <a-scene stats shadow="type: pcfsoft" physics="driver: local; debug: true; gravity: 0; friction: 0; restitution: 0;" renderer="antialias: true" cursor="rayOrigin: mouse" raycaster="objects: [cube]">
    <a-assets>
      <a-mixin id="touch" class="hands" ></a-mixin>
    </a-assets>

    <a-sky color="#888888"></a-sky>

      <!-- <a-entity collider-debug class="grabbable" event-set__hover-start="material.color: blue;"
      event-set__hover-end="material.color: red;" id="mycube" geometry="primitive: box; height: 0.30; width: 0.30; depth: 0.30"
      material="color: #EF2D5E;" position="0 0.75 -1"></a-entity>
      
      <a-entity class="grabbable" event-set__hover-start="material.color: blue;"
      event-set__hover-end="material.color: red;" geometry="primitive: box; height: 0.30; width: 0.30; depth: 0.30"
      material="color: #EF2D5E;" position="1 0.75 -1"></a-entity> -->

      
      <!-- <a-entity grabbable  data-aabb-collider-dynamic="true" class="grabbable" id="plot" scale="0.1 0.1 0.1" position="0 1 -1.5" plot="function: cos(x) + sin(y);
                    order: 32;
                    show_zero_planes: true;
                    bounds: -10 10 -10 10 -10 10;
                    color: #04F">
    </a-entity> -->
      
      <a-cylinder position="0 -1 0" color="#bbb" height="2" radius="4.5" shadow></a-cylinder>


        <a-entity data-aabb-collider-dynamic="true" class="grabbable" id="plot" scale="0.5 0.5 0.5" position="0 1 -0.8" graph="xMin: -3.2; xMax: 3.2; yMin: -3.2; yMax: 3.2; segmentsMultiplier: 2; showGrid: false; showGridLabels: false; function: f(x,y) = cos(x) + sin(y)"></a-entity >

      <a-entity position="-0.6 1.4 -0.2" rotation="0 150 0">
        <a-entity slider-events id="xslider-up" ui-slider="color: red; min: 0; max: 10; value: 6" rotation="0 0 90"></a-entity>
        <a-entity slider-text="slider: #xslider-up" position="0 0 0.6" rotation="0 -90 0" text="value: 6;"></a-entity>
        <a-entity position="0 0.1 0.6" rotation="0 -90 0" text="value: xMax;"></a-entity>
      </a-entity>
      <a-entity position="-0.6 0.8 -0.2" rotation="0 150 0">
        <a-entity slider-events id="xslider-down" ui-slider="color: red; min: 0; max: -10; value: -6" rotation="180 0 90"></a-entity>
        <a-entity slider-text="slider: #xslider-down" position="0 0 0.6" rotation="0 -90 0" text="value: -6;"></a-entity>
        <a-entity position="0 0.1 0.6" rotation="0 -90 0" text="value: xMin;"></a-entity>
      </a-entity>
      <a-entity position="-0.8 1.4 0.1" rotation="0 160 0">
        <a-entity slider-events id="zslider-up" ui-slider="color: red; min: 0; max: 10; value: 6" rotation="0 0 90"></a-entity>
        <a-entity slider-text="slider: #zslider-up" position="0 0 0.6" rotation="0 -90 0" text="value: 6;"></a-entity>
        <a-entity position="0 0.1 0.6" rotation="0 -90 0" text="value: zMax;"></a-entity>
      </a-entity>
      <a-entity position="-0.8 0.8 0.1" rotation="0 160 0">
        <a-entity slider-events id="zslider-down" ui-slider="color: red; min: 0; max: -10; value: -6" rotation="180 0 90"></a-entity>
        <a-entity slider-text="slider: #zslider-down" position="0 0 0.6" rotation="0 -90 0" text="value: -6;"></a-entity>
        <a-entity position="0 0.1 0.6" rotation="0 -90 0" text="value: zMin;"></a-entity>
      </a-entity>
      
      <a-entity position="-0.1 0.8 -0.5" rotation="0 90 0">
        <a-entity slider-events id="aslider-down" ui-slider="color: red; min: 1; max: 2.5; value: 1.2" rotation="180 0 90"></a-entity>
        <a-entity slider-text="slider: #aslider-down" position="0 0 0.6" rotation="0 -90 0" text="value: 1.2;"></a-entity>
        <a-entity position="0 0.1 0.6" rotation="0 -90 0" text="value: aValue;"></a-entity>
      </a-entity>

      <!-- <a-entity position="0 0.6 0">
      <a-entity position="-0.9 0.6 0.4" rotation="0 90 0" text="value: activate PI;align: center"></a-entity>
      <a-entity id="pi-toggle" ui-toggle position="-0.9 0.4 0.4" rotation="0 180 90"></a-entity>
      </a-entity> -->

      <a-entity position="0.9 0.6 0">
        <a-entity position="0 0.6 -0.1" rotation="0 -90 0" text="value: reset graph transform;align: center"></a-entity>
        <a-entity id="reset-button" ui-button position="0 0.4 -0.1" rotation="0 -180 -40"></a-entity>
      </a-entity>

      <a-entity position="0.9 0.6 0.4">
        <a-entity position="0 0.6 -0.1" rotation="0 -90 0" text="value: toggle grid;align: center"></a-entity>
        <a-entity id="grid-toggle" ui-toggle position="0 0.4 -0.1" rotation="70 -90 0"></a-entity>
      </a-entity>
      <a-entity position="0.9 1 0">
        <a-entity position="0 0.6 -0.1" rotation="0 -90 0" text="value: toggle wireframe;align: center"></a-entity>
        <a-entity id="wireframe-toggle" ui-toggle position="0 0.4 -0.1" rotation="70 -90 0"></a-entity>
      </a-entity>
      <a-entity position="0.9 1 0.4">
        <a-entity position="0 0.6 -0.1" rotation="0 -90 0" text="value: toggle labels;align: center"></a-entity>
        <a-entity id="label-toggle" ui-toggle position="0 0.4 -0.1" rotation="70 -90 0"></a-entity>
      </a-entity>

      <a-entity light="type: point; color: #ffffff; intensity: 0.6; castShadow: true" position="0 3 0"></a-entity>
      <a-entity light="type: ambient; color: #ffffff; intensity: 0.7;" position="0 3 0"></a-entity>

    <!-- <a-log rotation="0 45 0" position="-2 0 -1"></a-log> -->

    <!-- <a-box middle="otherhand: #rbox" position="-2 1.5 0"></a-box>
    <a-box id="rbox" position="2 1 0"></a-box> -->

    <a-entity interaction-hands aabb-collider="objects: .grabbable" id="lhand" hand-controls="hand: left; handModelStyle: highPoly" mixin="touch"></a-entity>
    <a-entity interaction-hands aabb-collider="objects: .grabbable" id="rhand" hand-controls="hand: right; handModelStyle: highPoly" mixin="touch"></a-entity>

    <a-entity position="0 1.6 0.5" camera look-controls wasd-controls></a-entity>
  </a-scene>
</body>
<script>
  const plot = document.querySelector("#plot");
  const xsliderup = document.querySelector("#xslider-up");
  const xsliderdown = document.querySelector("#xslider-down");
  const zsliderup = document.querySelector("#zslider-up");
  const zsliderdown = document.querySelector("#zslider-down");
  const asliderdown = document.querySelector("#aslider-down");

  function findGetParameter(parameterName) {
    var result = null,
        tmp = [];
    location.search
        .substr(1)
        .split("&")
        .forEach(function (item) {
          tmp = item.split("=");
          if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
        });
    return result;
  }

  const funcParameter = findGetParameter("func");
  const xMin = findGetParameter("xmin");
  const xMax = findGetParameter("xmax");
  const zMin = findGetParameter("zmin");
  const zMax = findGetParameter("zmax");
  const tMin = findGetParameter("tmin");
  const tMax = findGetParameter("tmax");

  let setting = {}
  if (funcParameter != null) {
      plot.setAttribute('graph', {
        function: decodeURIComponent(funcParameter)
      });
  }
  if (tMin != null) {
    plot.setAttribute('graph', {
      tMin: decodeURIComponent(tMin)
    });
  }
  if (tMax != null) {
    plot.setAttribute('graph', {
      tMax: decodeURIComponent(tMax)
    });
  }
  if (xMin != null) {
    plot.setAttribute('graph', {
      xMin: decodeURIComponent(xMin)
    });
  }
  if (xMax != null) {
    plot.setAttribute('graph', {
      xMax: decodeURIComponent(xMax)
    });
  }
  if (zMin != null) {
    plot.setAttribute('graph', {
      zMin: decodeURIComponent(zMin)
    });
  }
  if (zMax != null) {
    plot.setAttribute('graph', {
      zMax: decodeURIComponent(zMax)
    });
  }

  // const button = document.querySelector("#button");
  // const sliderText = document.querySelector("#text");
  xsliderup.addEventListener('change', (evt) => {
    var value = evt.detail.value;
    value = Math.floor(value * 10) / 10;
    plot.setAttribute("graph", {
      xMax: value
    })
  })

  xsliderup.addEventListener('change', (evt) => {
    var value = evt.detail.value;
    value = Math.floor(value * 10) / 10;
    plot.setAttribute("graph", {
      xMax: value
    })
  })

  xsliderdown.addEventListener('change', (evt) => {
    var value = evt.detail.value;
    value = Math.floor(value * 10) / 10;
    plot.setAttribute("graph", {
      xMin: value
    })
  })
  zsliderup.addEventListener('change', (evt) => {
    var value = evt.detail.value;
    value = Math.floor(value * 10) / 10;
    plot.setAttribute("graph", {
      yMax: value
    })
  })
  zsliderdown.addEventListener('change', (evt) => {
    var value = evt.detail.value;
    value = Math.floor(value * 10) / 10;
    plot.setAttribute("graph", {
      yMin: value
    })
  })

  asliderdown.addEventListener('change', (evt) => {
    var value = evt.detail.value;
    plot.setAttribute("graph", {
      a: value
    })
  })

  const sliders = [xsliderup, xsliderdown, zsliderup, zsliderdown]
  const activatePI = () => {
    this.pi = true;
    sliders.forEach((element) => {
      element.setAttribute('data-slider-pi-multiplier');
    });
    let currentSettings = plot.getAttribute('graph');
    plot.setAttribute('graph', {
      xMin: currentSettings.xMin * Math.PI,
      xMax: currentSettings.xMax * Math.PI,
      zMin: currentSettings.zMin * Math.PI,
      zMax: currentSettings.zMax * Math.PI,
    })
    this.sliderTextEntities = Array.prototype.slice.call(document.querySelectorAll('a-entity[slider-text]'));
    this.sliderTextEntities.forEach(function (el){
      el.components['slider-text'].forceUpdate();
    })
  }
  const deactivatePI = () => {
    this.pi = false;
    sliders.forEach((element) => {
      element.removeAttribute('data-slider-pi-multiplier');
    });
    let currentSettings = plot.getAttribute('graph');
    plot.setAttribute('graph', {
      xMin: currentSettings.xMin / Math.PI,
      xMax: currentSettings.xMax / Math.PI,
      zMin: currentSettings.zMin / Math.PI,
      zMax: currentSettings.zMax / Math.PI,
    })
    this.sliderTextEntities = Array.prototype.slice.call(document.querySelectorAll('a-entity[slider-text]'));
    this.sliderTextEntities.forEach(function (el){
      el.components['slider-text'].forceUpdate();
    })
  }

  // const piToggle = document.querySelector("#pi-toggle");

  // piToggle.addEventListener('change', (evt) => {
  //   if (evt.detail.value == 1) {
  //     activatePI();
  //   } else {
  //     deactivatePI();
  //   }
  // })

  const gridToggle = document.querySelector("#grid-toggle");

  gridToggle.addEventListener('change', (evt) => {
    plot.setAttribute("graph", {
      showGrid: evt.detail.value == 1
    })
  })
  const wireframeToggle = document.querySelector("#wireframe-toggle");

  wireframeToggle.addEventListener('change', (evt) => {
    plot.setAttribute("graph", {
      showWireframe: evt.detail.value == 1
    })
  })

  const labelToggle = document.querySelector("#label-toggle");

  labelToggle.addEventListener('change', (evt) => {
    plot.setAttribute("graph", {
      showGridLabels: evt.detail.value == 1
    })
  })

  const resetButton = document.querySelector("#reset-button");
  resetButton.addEventListener('pressed', (evt) => {
    plot.setAttribute('scale', '0.5 0.5 0.5');
    plot.setAttribute('position', '0 1 -0.8');
    plot.setAttribute('rotation', '0 0 0');
  })
  
  // var a = 1;

  // setInterval(() => {
  //   plot.setAttribute("graph", {
  //     a: a
  //   })
  //   a += 0.001;
  // }, 10);
  

</script>
</html>